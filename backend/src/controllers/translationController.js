// src/controllers/translationController.js
import { connectDB } from '../config/db.js';

const DEFAULT_TRANSLATIONS = [
  {
    lang: 'en',
    data: {
      // === CORE ===
      welcome: 'Welcome back!',
      library: 'Library Management System',
      getStarted: 'Get Started',
      explore: 'Explore Our Collection',
      discover: 'Discover thousands of books and resources',
      learn: 'Learn Without Limits',
      anywhere: 'anywhere',
      anytime: 'anytime',
      woldiaUniversity: 'Woldia University',
      connectsReaders: 'Library connects readers with knowledge',
      firstTimeLogin: 'First Time Login',
      username: 'Username',
      enterUsername: 'Enter your username',
      id: 'ID',
      enterId: 'Enter your ID',
      continue: 'Continue',
      checking: 'Checking...',
      error: 'An error occurred',
      alreadySetPassword: 'Already set password?',
      loginHere: 'Login here',
      setYourPassword: 'Set Your Password',
      firstLoginInstructions: 'This is your first login – please create a secure password.',
      passwordMinLength: 'Password must be 6+ characters',
      passwordsDoNotMatch: 'Passwords do not match',
      sessionExpired: 'Session expired. Please try again.',
      passwordChanged: 'Password changed! Redirecting...',
      changePasswordFailed: 'Failed to change password',
      saving: 'Saving...',
      changePassword: 'Change Password',
      login: 'Login',
      password: 'Password',
      enterPassword: 'Enter your password',
      showPassword: 'Show password',
      hidePassword: 'Hide password',
      signingIn: 'Signing in...',
      signIn: 'Sign In',
      loginFailed: 'Login failed',
      firstTime: 'First time',
      setPasswordHere: 'Click here to set password',
      copyright: 'Woldia University Library System © 2025',

      // === CHANGE PASSWORD ===
      oldPassword: 'Old Password',
      newPassword: 'New Password',
      confirmNewPassword: 'Confirm New Password',
      passwordChangedSuccess: 'Password changed successfully! Redirecting...',
      changing: 'Changing...',

      // === NEWS & UPDATES ===
      newsAndUpdates: 'News & Updates',
      stayInformed: 'Stay informed with library announcements',
      postNews: 'Post News',
      announceUpdates: 'Announce updates to all users',
      postNew: 'Post New',
      createNewsPost: 'Create News Post',
      news: 'News',
      searchNews: 'Search news...',

      // === ADMIN / LIBRARIAN DASHBOARD ===
      adminDashboard: 'Admin Dashboard',
      librarianDashboard: 'Librarian Dashboard',
      welcomeAdmin: "Welcome back! Here's what's happening in your library.",
      totalUsers: 'Total Users',
      totalBooks: 'Total Books',
      totalPosts: 'Total Posts',
      totalReports: 'Total Reports',
      userGrowth: 'User Growth',
      postsActivity: 'Posts Activity',
      recentlyRegisteredUsers: 'Recently Registered Users',
      noRecentUsers: 'No recent users.',
      manageUsers: 'Manage Users',
      addUser: 'Add User',
      searchUsers: 'Search users...',
      allRoles: 'All Roles',
      name: 'Name',
      role: 'Role',
      status: 'Status',
      actions: 'Actions',
      loading: 'Loading',
      noUsersFound: 'No users found.',
      edit: 'Edit',
      delete: 'Delete',
      showing: 'Showing',
      of: 'of',
      prev: 'Prev',
      next: 'Next',
      editUser: 'Edit User',
      addNewUser: 'Add New User',
      fullName: 'Full Name',
      departmentOptional: 'Department (optional)',
      update: 'Update',
      create: 'Create',
      cancel: 'Cancel',
      defaultPassword: 'Default password',
      changeOnFirstLogin: 'User will change it on first login.',
      userCreated: 'User created successfully!',
      userCreateFailed: 'Failed to create user',
      userUpdated: 'User updated successfully!',
      userUpdateFailed: 'Failed to update user',
      userDeleted: 'User deleted successfully!',
      userDeleteFailed: 'Failed to delete user',
      deleteUserConfirm: 'Delete this user permanently?',
      adminSettings: 'Admin Settings',
      recentActivity: 'Recent Activity',
      manageSystemPreferences: 'Manage system preferences, users, and security.',

      // === WEEKLY REPORT ===
      weeklyReportGenerator: 'Weekly Report Generator',
      chooseReportType: 'Choose a report type and click',
      generate: 'Generate',
      recentlyAddedUsers: 'Recently Added Users',
      recentlyAddedNews: 'Recently Added News',
      recentlyAddedBooks: 'Recently Added Books',
      deactivatedUsersThisWeek: 'Deactivated Users This Week',
      generatingReport: 'Generating report',
      reportFailed: 'Failed to generate report',
      week: 'Week',
      addedUsers: 'Added Users',
      deactivatedUsers: 'Deactivated Users',
      newsItems: 'News Items',
      booksAdded: 'Books Added',
      noRecordsThisWeek: 'No records this week.',

      // === COMMENTS / FEEDBACK ===
      allComments: 'All Comments',
      viewUserFeedback: 'View and search user feedback',
      markingAllAsRead: 'Marking all as read',
      giveFeedback: 'Give Feedback',
      shareThoughts: 'Share your thoughts',
      giveComment: 'Give Comment',

      // === LIBRARIAN SETTINGS ===
      librarianSetting: 'Librarian Settings',
      manageYourAccount: 'Manage your account, notifications, and preferences.',

      // === LIBRARIAN BOOKS ===
      libraryManagement: 'Library Management',
      manageBooksAndBorrowing: 'Manage books & borrowing',
      add: 'Add',
      borrow: 'Borrow',
      borrowed: 'Borrowed',
      return: 'Return',
      payFine: 'Pay Fine',
      search: 'Search',
      yourBorrow: 'Your Borrow',
      due: 'Due',
      fine: 'Fine',
      copies: 'Copies',
      action: 'Action',
      noBooks: 'No books',
      userId: 'User ID',
      book: 'Book',
      active: 'Active',
      returned: 'Returned',
      total: 'Total',
      page: 'Page',
      addBook: 'Add Book',
      updateBook: 'Update Book',
      enterBookId: 'Enter Book ID',
      exampleId: 'e.g. 123',
      load: 'Load',
      borrowBook: 'Borrow Book',
      returnBook: 'Return Book',
      payNow: 'Pay Now',
      payWithChapa: 'Pay with Chapa',
      payWithTelebirr: 'Pay with Telebirr',
      enterMobileNumber: 'Enter Mobile Number',
      back: 'Back',
      bookAdded: 'Book added!',
      bookLoaded: 'Book loaded',
      updated: 'Updated!',
      deleted: 'Deleted',
      finePaid: 'Fine paid!',
      failedToLoadBooks: 'Failed to load books',
      failedToLoadBorrowed: 'Failed to load borrowed books',
      addFailed: 'Add failed',
      updateFailed: 'Update failed',
      deleteFailed: 'Delete failed',
      borrowFailed: 'Borrow failed',
      returnFailed: 'Return failed',
      chapaFailed: 'Chapa failed',
      telebirrFailed: 'Telebirr failed',
      enterValidMobile: 'Enter valid mobile: 0912345678',
      pleaseLoginAgain: 'Please login again.',
      userInfoMissing: 'User info missing.',
      paidViaTelebirr: 'Paid via Telebirr',
      deleteConfirm: 'Delete?',
      notFound: 'Not found',

      // === DASHBOARD CARDS & CHARTS ===
      totalBooksBorrowed: 'Total Books Borrowed',
      borrowedBooks: 'Borrowed Books',
      returnedBooks: 'Returned Books',
      totalPaid: 'Total Paid',
      bookStatus: 'Book Status',
      bookReturns: 'Book Returns',
      returns: 'Returns',
      thu: 'Thu',
      fri: 'Fri',
      sat: 'Sat',
      sun: 'Sun',
      mon: 'Mon',
      tue: 'Tue',
      wed: 'Wed',

      // === BOOKS TABLE HEADERS ===
      bookId: 'Book ID',
      title: 'Title',
      category: 'Category',
      copies: 'Copies',
      borrowed: 'Borrowed',
      available: 'Available',
      action: 'Action',
      monitorLibraryFlow: 'Monitor Library Flow',

      // === STUDENT DASHBOARD (NEW) ===
      studentDashboard: 'Student Dashboard',
      totalBorrowedBooks: 'Total Borrowed Books',
      totalViews: 'Total Views',
      booksToReturn: 'Books to Return',
      readingProgress: 'Reading Progress',
      completed: 'Completed',
      currentlyBorrowedBooks: 'Currently Borrowed Books',
      noActiveBorrows: 'No active borrows.',
      borrowingHistory: 'Borrowing History',
      dueSoon: 'Due Soon',
      overdue: 'Overdue',
      returnBookConfirm: 'Return this book?',
      borrowRecordLoaded: 'Borrow record loaded',
      noBorrowFound: 'No borrow found',

      // === STUDENT SETTINGS ===
      studentSetting: 'Student Setting',

      // === STUDENT NEWS ===
      news: 'News',
      stayInformed: 'Stay informed with library announcements',

      // === STUDENT COMMENT ===
      giveFeedback: 'Give Feedback',
      shareThoughts: 'Share your thoughts with the admin',
      giveComment: 'Give Comment',
      sendToAdmin: 'Send to Admin',

      // === STUDENT LIBRARY (BOOKS PAGE) ===
      studentLibrary: 'Student Library',
      borrowReturnView: 'Borrow, return, and view your borrowed book',
      borrow: 'Borrow',
      viewBorrow: 'View Borrow',
      searchBooks: 'Search books...',
      yourBorrowedBook: 'Your Borrowed Book:',
      copiesAvailable: 'Copies Available',
      noBooksFound: 'No books found',
      borrowABook: 'Borrow a Book',
      borrowed: 'Borrowed!',
      viewYourBorrow: 'View Your Borrow',
      payFine: 'Pay Fine',
      initializing: 'Initializing...',
      processing: 'Processing...',
      enterMobileNumber: 'Enter Mobile Number',
      back: 'Back',
      bookName: 'Book Name',
      viewMyBorrow: 'View My Borrow',
      returned: 'Returned!',
      finePaid: 'Fine paid!',

      // === TEACHER DASHBOARD ===
      teacherDashboard: 'My Dashboard',
      trackBooksBorrowsReturns: 'Track your books, borrows, and returns.',
      booksAdded: 'Books Added',
      borrowedBooks: 'Borrowed',
      returnedBooks: 'Returned',
      booksAddedLast7Days: 'Books Added (Last 7 Days)',
      borrowedBooksLast4Weeks: 'Borrowed Books (Last 4 Weeks)',
      recentActivity: 'Recent Activity',
      noActivityYet: 'No activity yet.',

      // === TEACHER SETTINGS ===
      teacherSetting: 'Teacher Setting',

      // === TEACHER NEWS ===
      news: 'News',
      stayInformed: 'Stay informed with library announcements',

      // === TEACHER COMMENT ===
      giveFeedback: 'Give Feedback',
      shareThoughts: 'Share your thoughts with the admin',
      giveComment: 'Give Comment',
      sendToAdmin: 'Send to Admin',

      // === TEACHER LIBRARY (BOOKS PAGE) ===
      teacherLibrary: 'Teacher Library',
      addBorrowReturnView: 'Add, borrow, return, and view your borrow',
      addBook: 'Add Book',
      borrow: 'Borrow',
      return: 'Return',
      payFine: 'Pay Fine',
      viewBorrow: 'View Borrow',
      searchBooks: 'Search books...',
      yourBorrowedBook: 'Your Borrowed Book:',
      copiesAvailable: 'Copies Available',
      noBooksFound: 'No books found',
      addNewBook: 'Add New Book',
      borrowABook: 'Borrow a Book',
      borrowed: 'Borrowed!',
      viewYourBorrow: 'View Your Borrow',
      returnBook: 'Return Book',
      payFine: 'Pay Fine',
      initializing: 'Initializing...',
      processing: 'Processing...',
      enterMobileNumber: 'Enter Mobile Number',
      back: 'Back',
      bookName: 'Book Name',
      viewMyBorrow: 'View My Borrow',
      returned: 'Returned!',
      finePaid: 'Fine paid!',
      addBookForm: 'Add New Book',
      borrowBookForm: 'Borrow a Book',
      returnBookForm: 'Return Book',
      viewBorrowForm: 'View Your Borrow',
      payFineForm: 'Pay Fine',
      payWithChapa: 'Pay with Chapa',
      payWithTelebirr: 'Pay with Telebirr',
      cancel: 'Cancel',
      dashboard: 'Dashboard',
      users: 'Users',
      report: 'Report',
      comment: 'Comment',
      post: 'Post',
      setting: 'Setting',
      books: 'Books',
      news: 'News',
      logout: 'Logout',
      librarySystem: 'Library System',
      admin: 'Admin',
      teacher:'Teacher',
      librarian: 'Librarian',
      student: 'Student',
    },
  },
  {
    lang: 'am',
    data: {
      // === CORE (Amharic) ===
      welcome: 'እንኳን ደህና መጡ!',
      library: 'የቤተ መጻሕፍት አስተዳደር ሲስተም',
      getStarted: 'ይጀምሩ',
      explore: 'የእኛን ስብስብ ያስሱ',
      discover: 'ሺህዎች መጻሕፍትና መረጃዎች ይግለጡ',
      learn: 'ያለ ገደብ ይማሩ',
      anywhere: 'በማንኛውም ቦታ',
      anytime: 'በማንኛውም ጊዜ',
      woldiaUniversity: 'ወልዲያ ዩኒቨርሲቲ',
      connectsReaders: 'ቤተ መጻሕፍቱ አንባቢዎችን ከእውቀት ጋር ያገናኛል',
      firstTimeLogin: 'የመጀመሪያ ጊዜ መግቢያ',
      username: 'የመጠቀሚያ ስም',
      enterUsername: 'የመጠቀሚያ ስምዎን ያስገቡ',
      id: 'መለያ ቁጥር',
      enterId: 'መለያ ቁጥርዎን ያስገቡ',
      continue: 'ቀጥል',
      checking: 'በመፈተሽ ላይ...',
      error: 'ስህተት ተከስቷል',
      alreadySetPassword: 'የይለፍ ቃል ቀድሞ አዘጋጅተዋል?',
      loginHere: 'እዚህ ይግቡ',
      setYourPassword: 'የይለፍ ቃልዎን ያዘጋጁ',
      firstLoginInstructions: 'ይህ የመጀመሪያ ጊዜ መግባትዎ ነው – ደህንነቱ የተጠበቀ የይለፍ ቃል ይፍጠሩ።',
      passwordMinLength: 'የይለፍ ቃል ቢያንስ 6 ፊደል መሆን አለበት',
      passwordsDoNotMatch: 'የይለፍ ቃላቱ አይዛመዱም',
      sessionExpired: 'ክፍለ ጊዜው አብቅቷል። እንደገና ይሞክሩ።',
      passwordChanged: 'የይለፍ ቃል ተቀይሯል! ወደ መግቢያ ገጽ በመምራት ላይ...',
      changePasswordFailed: 'የይለፍ ቃል መቀየር አልተሳካም',
      saving: 'በማስቀመጥ ላይ...',
      changePassword: 'የይለፍ ቃል ቀይር',
      login: 'መግባት',
      password: 'የይለፍ ቃል',
      enterPassword: 'የይለፍ ቃልዎን ያስገቡ',
      showPassword: 'የይለፍ ቃል አሳይ',
      hidePassword: 'የይለፍ ቃል ደብቅ',
      signingIn: 'በመግባት ላይ...',
      signIn: 'ግባ',
      loginFailed: 'መግባት አልተሳካም',
      firstTime: 'የመጀመሪያ ጊዜ?',
      setPasswordHere: 'የይለፍ ቃል ለማዘጋጀት እዚህ ይጫኑ',
      copyright: 'ወልዲያ ዩኒቨርሲቲ ቤተ መጻሕፍት ሲስተም © 2025',

      // === NEWS & UPDATES ===
      newsAndUpdates: 'ዜና እና ዝመናዎች',
      stayInformed: 'ከቤተ መጻሕፍቱ ማስታወቂያዎች ጋር ተገናኝተው ይቆዩ',
      postNews: 'ዜና ልጥፍ',
      announceUpdates: 'ለሁሉም ተጠቃሚዎች ዝመናዎችን አስታውቅ',
      postNew: 'አዲስ ልጥፍ',
      createNewsPost: 'የዜና ልጥፍ ፍጠር',
      news: 'ዜና',
      searchNews: 'ዜናዎችን ፈልግ...',

      // === ADMIN / LIBRARIAN DASHBOARD ===
      adminDashboard: 'የአስተዳዳሪ ዳሽቦርድ',
      librarianDashboard: 'የቤተ መጻሕፍት አስተዳዳሪ ዳሽቦርድ',
      welcomeAdmin: 'እንኳን በደህና መጡ! በቤተ መጻሕፍትዎ ውስጥ ምን እየተከናወነ እንዳለ ይመልከቱ።',
      totalUsers: 'ጠቅላላ ተጠቃሚዎች',
      totalBooks: 'ጠቅላላ መጻሕፍት',
      totalPosts: 'ጠቅላላ ልጥፎች',
      totalReports: 'ጠቅላላ ሪፖርቶች',
      userGrowth: 'የተጠቃሚ እድገት',
      postsActivity: 'የልጥፍ እንቅስቃሴ',
      recentlyRegisteredUsers: 'በቅርብ ጊዜ የተመዘገቡ ተጠቃሚዎች',
      noRecentUsers: 'በቅርብ ጊዜ የተመዘገቡ ተጠቃሚዎች የሉም።',
      manageUsers: 'ተጠቃሚዎችን ያስተዳድሩ',
      addUser: 'ተጠቃሚ ያክሉ',
      searchUsers: 'ተጠቃሚዎችን ይፈልጉ...',
      allRoles: 'ሁሉም ሚናዎች',
      name: 'ስም',
      role: 'ሚና',
      status: 'ሁኔታ',
      actions: 'ተግባራት',
      loading: 'በመጫን ላይ',
      noUsersFound: 'ምንም ተጠቃሚዎች አልተገኙም።',
      edit: 'አርም',
      delete: 'ሰርዝ',
      showing: 'እያሳየ',
      of: 'ከ',
      prev: 'ቀዳሚ',
      next: 'ቀጣይ',
      editUser: 'ተጠቃሚ ያርሙ',
      addNewUser: 'አዲስ ተጠቃሚ ያክሉ',
      fullName: 'ሙሉ ስም',
      departmentOptional: 'ዲፓርትመንት (አማራጭ)',
      update: 'ያዘምኑ',
      create: 'ፍጠር',
      cancel: 'ሰርዝ',
      defaultPassword: 'ነባሪ የይለፍ ቃል',
      changeOnFirstLogin: 'ተጠቃሚው በመጀመሪያ መግቢያ ይቀይረዋል።',
      userCreated: 'ተጠቃሚ በተሳካ ሁኔታ ተፈጥሯል!',
      userCreateFailed: 'ተጠቃሚ መፍጠር አልተሳካም',
      userUpdated: 'ተጠቃሚ በተሳካ ሁኔታ ተዘምኗል!',
      userUpdateFailed: 'ተጠቃሚ ማዘመን አልተሳካም',
      userDeleted: 'ተጠቃሚ በተሳካ ሁኔታ ተሰርዟል!',
      userDeleteFailed: 'ተጠቃሚ መሰረዝ አልተሳካም',
      deleteUserConfirm: 'ይህን ተጠቃሚ በቋሚነት መሰረዝ ይፈልጋሉ?',
      adminSettings: 'የአስተዳዳሪ ቅንብሮች',
      recentActivity: 'የቅርብ ጊዘ ስራዎች',
      manageSystemPreferences: 'የስርዓት ምርጫዎችን፣ ተጠቃሚዎችን እና ደህንነትን ያስተዳድሩ።',

      // === COMMENTS / FEEDBACK ===
      allComments: 'ሁሉም አስተያየቶች',
      viewUserFeedback: 'የተጠቃሚ አስተያየቶችን ይመልከቱ እና ይፈልጉ',
      markingAllAsRead: 'ሁሉንም እንደ ተነበበ በማድረግ ላይ',
      giveFeedback: 'አስተያየት ይስጡ',
      shareThoughts: 'አስተሳሰብዎን ያካፍሉ',
      giveComment: 'አስተያየት ይስጡ',

      // === LIBRARIAN SETTINGS ===
      librarianSetting: 'የቤተ መጻሕፍት አስተዳዳሪ ቅንብሮች',
      manageYourAccount: 'መለያዎን፣ ማሳወቂያዎችን እና ምርጫዎችን ያስተዳድሩ።',

      // === LIBRARIAN BOOKS ===
      libraryManagement: 'የመጽሐፍ አስተዳደር',
      manageBooksAndBorrowing: 'መጻሕፍትና ብድርን ያስተዳድሩ',
      add: 'ጨምር',
      borrow: 'ተበድር',
      borrowed: 'የተበደሩ',
      return: 'መልስ',
      payFine: 'ቅጣት ይክፈሉ',
      search: 'ፈልግ',
      yourBorrow: 'የእርስዎ ብድር',
      due: 'የሚያልቅበት',
      fine: 'ቅጣት',
      copies: 'ቅጂዎች',
      action: 'ተግባር',
      noBooks: 'መጻሕፍት የሉም',
      userId: 'የተጠቃሚ መለያ',
      book: 'መጽሐፍ',
      active: 'ንቁ',
      returned: 'ተመልሷል',
      total: 'ጠቅላላ',
      page: 'ገጽ',
      addBook: 'መጽሐፍ ጨምር',
      updateBook: 'መጽሐፍ ያዘምኑ',
      enterBookId: 'የመጽሐፍ መለያ ያስገቡ',
      exampleId: 'ለምሳሌ፡ 123',
      load: 'ጫን',
      borrowBook: 'መጽሐፍ ተበድር',
      returnBook: 'መጽሐፍ መልስ',
      payNow: 'አሁን ይክፈሉ',
      payWithChapa: 'በቻፓ ይክፈሉ',
      payWithTelebirr: 'በቴሌብር ይክፈሉ',
      enterMobileNumber: 'የስልክ ቁጥር ያስገቡ',
      back: 'ወደ ኋላ',
      bookAdded: 'መጽሐፍ ተጨምሯል!',
      bookLoaded: 'መጽሐፍ ተጫነ',
      updated: 'ተዘምኗል!',
      deleted: 'ተሰርዟል',
      finePaid: 'ቅጣት ተከፍሏል!',
      failedToLoadBooks: 'መጻሕፍትን መጫን አልተሳካም',
      failedToLoadBorrowed: 'የተበደሩ መጻሕፍትን መጫን አልተሳካም',
      addFailed: 'መጨመር አልተሳካ።',
      updateFailed: 'ማዘመን አልተሳካም',
      deleteFailed: 'መሰረዝ አልተሳካም',
      borrowFailed: 'ብድር አልተሳካም',
      returnFailed: 'መልስ አልተሳካም',
      chapaFailed: 'ቻፓ አልተሳካም',
      telebirrFailed: 'ቴሌብር አልተሳካም',
      enterValidMobile: 'ትክክለኛ ስልክ ያስገቡ፡ 0912345678',
      pleaseLoginAgain: 'እንደገና ይግቡ።',
      userInfoMissing: 'የተጠቃሚ መረጃ ጠፋ።',
      paidViaTelebirr: 'በቴሌብር ተከፍሏል',
      deleteConfirm: 'መሰረዝ?',
      notFound: 'አልተገኘም',

      // === DASHBOARD CARDS & CHARTS ===
      totalBooksBorrowed: 'ጠቅላላ የተበደሩ መጻሕፍት',
      borrowedBooks: 'የተበደሩ መጻሕፍት',
      returnedBooks: 'የተመለሱ መጻሕፍት',
      totalPaid: 'ጠቅላላ የተከፈለ',
      bookStatus: 'የመጽሐፍ ሁኔታ',
      bookReturns: 'የመጽሐፍ መመለሻ',
      returns: 'መመለሻዎች',
      thu: 'ሐሙስ',
      fri: 'ዓርብ',
      sat: 'ቅዳሜ',
      sun: 'እሑድ',
      mon: 'ሰኞ',
      tue: 'ማክሰኞ',
      wed: 'ረቡዕ',

      // === BOOKS TABLE HEADERS ===
      bookId: 'የመጽሐፍ መለያ',
      title: 'ርዕስ',
      category: 'ምድብ',
      copies: 'ቅጂዎች',
      borrowed: 'የተበደሩ',
      available: 'ዝግጁ',
      action: 'ተግባር',
      monitorLibraryFlow: 'የቤተ መጻሕፍት ፍሰት ይከታተሉ',

      // === STUDENT DASHBOARD (NEW) ===
      studentDashboard: 'የተማሪ ዳሽቦርድ',
      totalBorrowedBooks: 'ጠቅላላ የተበደሩ መጻሕፍት',
      totalViews: 'ጠቅላላ ዕይታዎች',
      booksToReturn: 'ለመመለስ መጻሕፍት',
      readingProgress: 'የንባብ እድገት',
      completed: 'ተጠናቀቀ',
      currentlyBorrowedBooks: 'አሁን የተበደሩ መጻሕፍት',
      noActiveBorrows: 'ንቁ ብድር የለም።',
      borrowingHistory: 'የብድር ታሪክ',
      dueSoon: 'በቅርቡ ያልቃል',
      overdue: 'ያለፈበት',
      returnBookConfirm: 'ይህን መጽሐፍ መልስ?',
      borrowRecordLoaded: 'የብድር መዝገብ ተጫነ',
      noBorrowFound: 'ብድር አልተገኘም',

      // === STUDENT SETTINGS ===
      studentSetting: 'የተማሪ ቅንብሮች',

      // === STUDENT NEWS ===
      news: 'ዜና',
      stayInformed: 'ከቤተ መጻሕፍቱ ማስታወቂያዎች ጋር ተገናኝተው ይቆዩ',

      // === STUDENT COMMENT ===
      giveFeedback: 'አስተያየት ይስጡ',
      shareThoughts: 'አስተሳሰብዎን ከአስተዳዳሪው ጋር ያካፍሉ',
      giveComment: 'አስተያየት ይስጡ',
      sendToAdmin: 'ወደ አስተዳዳሪ ላክ',

      // === STUDENT LIBRARY (BOOKS PAGE) ===
      studentLibrary: 'የተማሪ ቤተ መጻሕፍት',
      borrowReturnView: 'ተበድር፣ መልስ፣ እና የተበደሩትን ይመልከቱ',
      borrow: 'ተበድር',
      viewBorrow: 'ብድር ይመልከቱ',
      searchBooks: 'መጻሕፍትን ፈልግ...',
      yourBorrowedBook: 'የእርስዎ የተበደረ መጽሐፍ፡',
      copiesAvailable: 'ዝግጁ ቅጂዎች',
      noBooksFound: 'መጻሕፍት አልተገኙም',
      borrowABook: 'መጽሐፍ ተበድር',
      borrowed: 'ተበድሯል!',
      viewYourBorrow: 'የእርስዎን ብድር ይመልከቱ',
      payFine: 'ቅጣት ይክፈሉ',
      initializing: 'በመጀመር ላይ...',
      processing: 'በመስራት ላይ...',
      enterMobileNumber: 'የስልክ ቁጥር ያስገቡ',
      back: 'ወደ ኋላ',
      bookName: 'የመጽሐፍ ስም',
      viewMyBorrow: 'የእኔን ብድር ይመልከቱ',
      returned: 'ተመልሷል!',
      finePaid: 'ቅጣት ተከፍሏል!',

      // === TEACHER DASHBOARD ===
      teacherDashboard: 'የእኔ ዳሽቦርድ',
      trackBooksBorrowsReturns: 'መጻሕፍትዎን፣ ብድሮችዎን፣ እና መመለሻዎችዎን ይከታተሉ።',
      booksAdded: 'የተጨመሩ መጻሕፍት',
      borrowedBooks: 'የተበደሩ',
      returnedBooks: 'የተመለሱ',
      booksAddedLast7Days: 'የተጨመሩ መጻሕፍት (የመጨረሻ 7 ቀናት)',
      borrowedBooksLast4Weeks: 'የተበደሩ መጻሕፍት (የመጨረሻ 4 ሳምንታት)',
      recentActivity: 'የቅርብ ጊዜ እንቅስቃሴ',
      noActivityYet: 'እስካሁን ምንም እንቅስቃሴ የለም።',

      // === TEACHER SETTINGS ===
      teacherSetting: 'የመምህር ቅንብሮች',

      // === TEACHER NEWS ===
      news: 'ዜና',
      stayInformed: 'ከቤተ መጻሕፍቱ ማስታወቂያዎች ጋር ተገናኝተው ይቆዩ',

      // === TEACHER COMMENT ===
      giveFeedback: 'አስተያየት ይስጡ',
      shareThoughts: 'አስተሳሰብዎን ከአስተዳዳሪው ጋር ያካፍሉ',
      giveComment: 'አስተያየት ይስጡ',
      sendToAdmin: 'ወደ አስተዳዳሪ ላክ',

      // === TEACHER LIBRARY (BOOKS PAGE) ===
      teacherLibrary: 'የመምህር ቤተ መጻሕፍት',
      addBorrowReturnView: 'ጨምር፣ ተበድር፣ መልስ፣ እና ብድርዎን ይመልከቱ',
      addBook: 'መጽሐፍ ጨምር',
      borrow: 'ተበድር',
      return: 'መልስ',
      payFine: 'ቅጣት ይክፈሉ',
      viewBorrow: 'ብድር ይመልከቱ',
      searchBooks: 'መጻሕፍትን ፈልግ...',
      yourBorrowedBook: 'የእርስዎ የተበደረ መጽሐፍ፡',
      copiesAvailable: 'ዝግጁ ቅጂዎች',
      noBooksFound: 'መጻሕፍት አልተገኙም',
      addNewBook: 'አዲስ መጽሐፍ ጨምር',
      borrowABook: 'መጽሐፍ ተበድር',
      borrowed: 'ተበድሯል!',
      viewYourBorrow: 'የእርስዎን ብድር ይመልከቱ',
      returnBook: 'መጽሐፍ መልስ',
      payFine: 'ቅጣት ይክፈሉ',
      initializing: 'በመጀመር ላይ...',
      processing: 'በመስራት ላይ...',
      enterMobileNumber: 'የስልክ ቁጥር ያስገቡ',
      back: 'ወደ ኋላ',
      bookName: 'የመጽሐፍ ስም',
      viewMyBorrow: 'የእኔን ብድር ይመልከቱ',
      returned: 'ተመልሷል!',
      finePaid: 'ቅጣት ተከፍሏል!',
      addBookForm: 'አዲስ መጽሐፍ ጨምር',
      borrowBookForm: 'መጽሐፍ ተበድር',
      returnBookForm: 'መጽሐፍ መልስ',
      viewBorrowForm: 'የእርስዎን ብድር ይመልከቱ',
      payFineForm: 'ቅጣት ይክፈሉ',
      payWithChapa: 'በቻፓ ይክፈሉ',
      payWithTelebirr: 'በቴሌብር ይክፈሉ',
      cancel: 'ሰርዝ',
      dashboard: 'ዳሽቦርድ',
      users: 'ተጠቃሚዎች',
      report: 'ሪፖርት',
      comment: 'አስተያየት',
      post: 'ልጣፍ',
      setting: 'ማስተካከያ',
      books: 'መጽሐፍቶች',
      news: 'ዜናዎች',
      logout: 'ውጣ',
      librarySystem: 'ቤተ መጻሕፍት ሲስተም',
      admin: 'አስተዳዳሪ',
      teacher:'መምህር',
      librarian: 'ቤተ መጻሕፍት አስተዳዳሪ',
      student: 'ተማሪ',
    },
  },
];

export const getTranslations = async (req, res) => {
  try {
    const { lang } = req.params;
    if (!['en', 'am'].includes(lang)) {
      return res.status(400).json({ message: 'Invalid language' });
    }

    const db = await connectDB();
    const coll = db.collection('translations');

    let doc = await coll.findOne({ lang });
    if (!doc) {
      const defaultData = DEFAULT_TRANSLATIONS.find(t => t.lang === lang);
      if (defaultData) await coll.insertOne(defaultData);
      doc = defaultData;
    }

    if (!doc) return res.status(404).json({ message: 'Language not found' });

    res.json(doc.data);
  } catch (err) {
    console.error('Translation error:', err);
    res.status(500).json({ message: 'Server error' });
  }
};